#!/usr/bin/env bash

set -euo pipefail

trap stop SIGINT SIGTERM SIGQUIT

function stop() {
  hyprctl --instance 0 keyword monitor eDP-1,preferred,auto,1
  hyprctl --instance 0 keyword monitor HEADLESS-2,disable
}

function run() {
  notify-send "Vnc switch in 3 sec"
  sleep 3

  hyprctl --instance 0 monitors | grep -q HEADLESS \
    || hyprctl --instance 0 output create headless

  hyprctl --instance 0 keyword monitor eDP-1,disable
  hyprctl --instance 0 keyword monitor HEADLESS-2,1920x1080,0x0,1
  wayvnc 0.0.0.0
}

if [ $# == 1 ] && [ "$1" == "stop" ]; then
  stop
  exit 0
fi

run
